<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: Rackful
  
    &mdash; Lucipher
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: Rackful</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'>
<p>Library for creating ReSTful web services</p>

<p>The latest “stable” documentation can be found here:</p>
<ul><li>
<p><a href="http://pieterb.github.com/Rackful/">User documentation</a></p>
</li><li>
<p><a href="http://pieterb.github.com/Rackful/devel/">Developer
documentation</a> (includes  documentation for private methods and other
internals)</p>
</li></ul>

<h1 id="label-Overview">Overview</h1>

<p>Confronted with the task of implementing a ReSTful web service in Ruby, I
checked out a number of existing libraries and frameworks, including
Ruby-on-Rails, and then decided to brew my own, the reason being that I
couldn’t find a library or framework with all of the following properties:</p>
<ul><li>
<p><strong>Small</strong> Some of these frameworks are really big. I need to
get a job done in time. If understanding the framework takes more time than
writing my own, I must at least feel confident that the framework I’m
learning is more powerful that what I can come up with by myself.
Ruby-on-Rails is probably the biggest framework out there, and it still
lacks many features that are essential to ReSTful web service programming.</p>

<p>This library is small. You could read <em>all</em> the source code in less
than an hour, and understand every detail.</p>
</li><li>
<p><strong>No extensive tooling or code generation</strong> Code generation
has been the subject of more than one flame-war over the years. Not much I
can add to the debate...</p>

<p><em>…but,</em> with Ruby, you shouldn’t <em>need</em> code generation!
Unless, of course, you’re an ex-Java programmer and/or don’t understand
meta-programming.</p>
</li><li>
<p><strong>Full support for conditional requests</strong> using
<code>If-*:</code> request headers. Most libraries’ support is limited to
<code>If-None-Match:</code> and <code>If-Modified-Since:</code> headers,
and only for <code>GET</code> and <code>HEAD</code> requests. For ReSTful
web services, the <code>If-Match:</code> and
<code>If-Unmodified-Since:</code> headers are at least as important,
particularly for unsafe methods like <code>PUT</code>, <code>POST</code>,
<code>PATCH</code>, and <code>DELETE</code>.</p>

<p>This library fully supports the <code>ETag:</code> and
<code>Last-Modified:</code> headers, and all <code>If-*:</code> headers.</p>
</li><li>
<p><strong>Resource centered</strong> Some libraries claim ReSTfulness, but at
the same time have a servet-like interface, which requires you to implement
method handles such as <code>doPOST(url)</code>. In these method handlers
you have to find out what resource is posted to, depending on the URL.</p>

<p>This library requires that you implement a Resource Factory which maps URIs
to resource Objects. These objects will then receive HTTP requests.</p>
</li></ul>

<h2 id="label-Hello+World%21">Hello World!</h2>

<p>Here’s a working example of a simple ReSTful server:</p>

<p><pre class="code ruby"><span class='comment'># Load core functionality:
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rackful</span><span class='tstring_end'>'</span></span>

<span class='comment'># Load extra middlewares: ({Rackful::MethodOverride}, {Rackful::HeaderSpoofing})
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rackful/middleware</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>digest/md5</span><span class='tstring_end'>'</span></span>

<span class='comment'># The class of the object we're going to serve:
</span><span class='kw'>class</span> <span class='const'>Root</span> <span class='op'>&lt;</span> <span class='const'>Rackful</span><span class='op'>::</span><span class='const'>Resource</span>
  <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:to_rackful</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
    <span class='kw'>super</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://localhost:9292/hallo_wereld</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
    <span class='ivar'>@to_rackful</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='symbol'>:a</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Hello</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
      <span class='symbol'>:b</span> <span class='op'>=&gt;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='comma'>,</span>
      <span class='symbol'>:c</span> <span class='op'>=&gt;</span> <span class='const'>URI</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://www.example.com/some/path</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_do_PUT'>do_PUT</span> <span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_response'>response</span>
    <span class='ivar'>@to_rackful</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parser'>parser</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_get_etag'>get_etag</span>
    <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_to_rackful'>to_rackful</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_add_serializer'>add_serializer</span> <span class='const'>Rackful</span><span class='op'>::</span><span class='const'>Serializer</span><span class='op'>::</span><span class='const'>XHTML</span><span class='comma'>,</span> <span class='float'>1.0</span>
  <span class='id identifier rubyid_add_serializer'>add_serializer</span> <span class='const'>Rackful</span><span class='op'>::</span><span class='const'>Serializer</span><span class='op'>::</span><span class='const'>JSON</span><span class='comma'>,</span> <span class='float'>0.5</span>
  <span class='id identifier rubyid_add_parser'>add_parser</span> <span class='const'>Rackful</span><span class='op'>::</span><span class='const'>Parser</span><span class='op'>::</span><span class='const'>XHTML</span>
  <span class='id identifier rubyid_add_parser'>add_parser</span> <span class='const'>Rackful</span><span class='op'>::</span><span class='const'>Parser</span><span class='op'>::</span><span class='const'>JSON</span>
<span class='kw'>end</span>
<span class='gvar'>$root_resource</span> <span class='op'>=</span> <span class='kw'>nil</span>

<span class='id identifier rubyid_use'>use</span> <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Reloader</span>
<span class='id identifier rubyid_use'>use</span> <span class='const'>Rackful</span><span class='op'>::</span><span class='const'>MethodOverride</span>
<span class='id identifier rubyid_use'>use</span> <span class='const'>Rackful</span><span class='op'>::</span><span class='const'>HeaderSpoofing</span>

<span class='id identifier rubyid_run'>run</span> <span class='const'>Rackful</span><span class='op'>::</span><span class='const'>Server</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_uri'>uri</span><span class='op'>|</span>
  <span class='gvar'>$root_resource</span> <span class='op'>||=</span> <span class='const'>Root</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='rbrace'>}</span></pre></p>

<p>This file is included in the distribution as
<code>example/config.ru</code>. If you go to the <code>example</code>
directory and run <code>rackup</code>, you should see something like this:</p>

<pre class="code ruby"><code class="ruby">$&gt; rackup
[2012-07-10 11:45:32] INFO  WEBrick 1.3.1
[2012-07-10 11:45:32] INFO  ruby 1.9.2 (2011-12-27) [java]
[2012-07-10 11:45:32] INFO  WEBrick::HTTPServer#start: pid=5994 port=9292</code></pre>

<p>Go with your browser to <a href="http://localhost:9292/" target="_parent" title="http://localhost:9292/">http://localhost:9292/</a> and be greeted.</p>

<p>In this example, we implement <code>GET</code> and <code>PUT</code>
requests for the resource at “/”. but we get a few things for free:</p>

<h3 id="label-Free+OPTIONS+response%3A">Free <code>OPTIONS</code> response:</h3>

<p>Request:</p>

<pre class="code ruby"><code class="ruby">OPTIONS / HTTP/1.1
Host: localhost:9292</code></pre>

<p>Response:</p>

<pre class="code ruby"><code class="ruby">HTTP/1.1 204 No Content
Allow: PUT, GET, HEAD, OPTIONS
Date: Tue, 10 Jul 2012 10:22:52 GMT</code></pre>

<p>As you can see, the server accurately reports all available methods for the
resource. Notice the availability of the <code>HEAD</code> method; if you
implement the <code>GET</code> method, you’ll get <code>HEAD</code> for
free. It’s still a good idea to explicitly implement your own
<code>HEAD</code> request handler, especially for expensive resources, when
responding to a <code>HEAD</code> request should be much more efficient
than generating a full <code>GET</code> response, and strip off the
response body.</p>

<h3 id="label-Free+conditional+request+handling%3A">Free conditional request handling:</h3>

<p>Let’s first get the current state of the resource, with this request:</p>

<pre class="code ruby"><code class="ruby">GET / HTTP/1.1
Host: localhost:9292</code></pre>

<p>Response:</p>

<pre class="code ruby"><code class="ruby">HTTP/1.1 200 OK
Content-Type: text/plain
Content-Length: 12
ETag: &quot;86fb269d190d2c85f6e0468ceca42a20&quot;
Date: Tue, 10 Jul 2012 10:34:36 GMT

Hello world!</code></pre>

<p>Now, we’d like to change the state of the resource, but only if it’s still
in the state we last saw, to avoid the “lost update problem”. To do that,
we produce an <code>If-Match:</code> header, with the entity tag of our
last version:</p>

<pre class="code ruby"><code class="ruby">PUT / HTTP/1.1
Host: localhost:9292
Content-Type: text/plain
Content-Length: 31
If-Match: &quot;86fb269d190d2c85f6e0468ceca42a20&quot;

All your base are belong to us.</code></pre>

<p>Response:</p>

<pre class="code ruby"><code class="ruby">HTTP/1.1 204 No Content
ETag: &quot;920c1e9267f923c62b55a471c1d8a528&quot;
Date: Tue, 10 Jul 2012 10:58:57 GMT</code></pre>

<p>The response contains an <code>ETag:</code> header, with the <em>new</em>
entity tag of this resource. When we replay this request, we get the
following response:</p>

<pre class="code ruby"><code class="ruby">HTTP/1.1 412 Precondition Failed
Content-Type: text/html; charset=&quot;UTF-8&quot;
Date: Tue, 10 Jul 2012 11:06:54 GMT

[...]
&lt;h1&gt;HTTP/1.1 412 Precondition Failed&lt;/h1&gt;
&lt;p&gt;If-Match: &quot;86fb269d190d2c85f6e0468ceca42a20&quot;&lt;/p&gt;
[...]</code></pre>

<p>The server returns with status <code>412 Precondition Failed</code>. In the
HTML response body, the server kindly points out exactly which
precondition.</p>

<h2 id="label-Further+reading">Further reading</h2>
<ul><li>
<p><span class='object_link'><a href="Rackful/Server.html#initialize-instance_method" title="Rackful::Server#initialize (method)">Rackful::Server#initialize</a></span> for more information about your Resource
Factory.</p>
</li><li>
<p><span class='object_link'><a href="Rackful/Resource.html#get_etag-instance_method" title="Rackful::Resource#get_etag (method)">Rackful::Resource#get_etag</a></span> and <span class='object_link'><a href="Rackful/Resource.html#get_last_modified-instance_method" title="Rackful::Resource#get_last_modified (method)">Rackful::Resource#get_last_modified</a></span> for
more information on conditional requests.</p>
</li><li>
<p><span class='object_link'><a href="Rackful/Resource.html#do_METHOD-instance_method" title="Rackful::Resource#do_METHOD (method)">Rackful::Resource#do_METHOD</a></span> for more information about writing your own
request handlers.</p>
</li></ul>

<h1 id="label-Development">Development</h1>

<p>Some conventions used throughout the code and documentation:</p>
<ul><li>
<p>In <span class='object_link'><a href="Rack.html" title="Rack (module)">Rack</a></span>, URLs are represented by Ruby Strings. In Rackful, URLs are
represented by objects of class URI::HTTP wherever possible. This can
lead to confusion. As a convention, methods and variables that
return/contain a URL String have <code>url</code> in their names. while
methods and variables that return/contain a URI::HTTP object have
<code>uri</code> in their names. Yes, it’s ugly, but it helps.</p>
</li><li>
<p>URI’s are stored and passed around in their <span class='object_link'><a href="URI/Generic.html#normalize-instance_method" title="URI::Generic#normalize (method)">normalized</a></span> form wherever possible.</p>
</li></ul>

<h1 id="label-Licensing">Licensing</h1>

<p>Copyright ©2011-2014 Pieter van Beek <a
href="mailto:pieter@djinnit.com">pieter@djinnit.com</a></p>

<p>Licensed under the <a href="file.LICENSE.html" title="Apache License 2.0">Apache License 2.0</a>. You should have
received a copy of the license as part of this distribution.</p>
</div></div>

    <div id="footer">
  Generated on Fri Feb 14 16:37:14 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.3 (ruby-1.9.3).
</div>

  </body>
</html>