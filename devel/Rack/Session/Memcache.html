<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Rack::Session::Memcache
  
    &mdash; Lucipher
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (M)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Rack.html" title="Rack (module)">Rack</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Session.html" title="Rack::Session (module)">Session</a></span></span>
     &raquo; 
    <span class="title">Memcache</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Rack::Session::Memcache
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Abstract/ID.html" title="Rack::Session::Abstract::ID (class)">Abstract::ID</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="Abstract/ID.html" title="Rack::Session::Abstract::ID (class)">Abstract::ID</a></span></li>
          
            <li class="next">Rack::Session::Memcache</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">rack/rack/session/memcache.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Rack::Session::Memcache provides simple cookie based session management.
Session data is stored in memcached. The corresponding session key is
maintained in the cookie. You may treat Session::Memcache as you would
Session::Pool with the following caveats.</p>
<ul><li>
<p>Setting :expire_after to 0 would note to the Memcache server to hang  onto
the session data until it would drop it according to it's own 
specifications. However, the cookie sent to the client would expire 
immediately.</p>
</li></ul>

<p>Note that memcache does drop data before it may be listed to expire. For a
full description of behaviour, please see memcache's documentation.</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="DEFAULT_OPTIONS-constant" class="">DEFAULT_OPTIONS =
          
        </dt>
        <dd><pre class="code"><span class='const'>Abstract</span><span class='op'>::</span><span class='const'>ID</span><span class='op'>::</span><span class='const'>DEFAULT_OPTIONS</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span> <span class='symbol'>::namespace</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rack:session</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
<span class='symbol'>:memcache_server</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>localhost:11211</span><span class='tstring_end'>'</span></span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_options-instance_method" title="#default_options (instance method)">- (void) <strong>default_options</strong> </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      inherited
      from <span class='object_link'><a href="Abstract/ID.html#default_options-instance_method" title="Rack::Session::Abstract::ID#default_options (method)">Abstract::ID</a></span>
    </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute default_options.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#key-instance_method" title="#key (instance method)">- (void) <strong>key</strong> </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      inherited
      from <span class='object_link'><a href="Abstract/ID.html#key-instance_method" title="Rack::Session::Abstract::ID#key (method)">Abstract::ID</a></span>
    </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute key.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#mutex-instance_method" title="#mutex (instance method)">- (void) <strong>mutex</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute mutex.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#pool-instance_method" title="#pool (instance method)">- (void) <strong>pool</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute pool.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy_session-instance_method" title="#destroy_session (instance method)">- (void) <strong>destroy_session</strong>(env, session_id, options) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_sid-instance_method" title="#generate_sid (instance method)">- (void) <strong>generate_sid</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_session-instance_method" title="#get_session (instance method)">- (void) <strong>get_session</strong>(env, sid) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Memcache) <strong>initialize</strong>(app, options = {}) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of Memcache.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_session-instance_method" title="#set_session (instance method)">- (void) <strong>set_session</strong>(env, session_id, new_session, options) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with_lock-instance_method" title="#with_lock (instance method)">- (void) <strong>with_lock</strong>(env, default = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Rack::Session::Memcache (class)">Memcache</a></span></tt>) <strong>initialize</strong>(app, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of Memcache</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31
32
33
34
35
36
37
38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/memcache.rb', line 29</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_app'>app</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>super</span>

  <span class='ivar'>@mutex</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_mserv'>mserv</span> <span class='op'>=</span> <span class='ivar'>@default_options</span><span class='lbracket'>[</span><span class='symbol'>:memcache_server</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_mopts'>mopts</span> <span class='op'>=</span> <span class='ivar'>@default_options</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='op'>!</span><span class='const'>MemCache</span><span class='op'>::</span><span class='const'>DEFAULT_OPTIONS</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_k'>k</span> <span class='rbrace'>}</span>

  <span class='ivar'>@pool</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:cache</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'>MemCache</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_mserv'>mserv</span><span class='comma'>,</span> <span class='id identifier rubyid_mopts'>mopts</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_active?'>active?</span> <span class='kw'>and</span> <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_servers'>servers</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_alive?'>alive?</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>No memcache servers</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="default_options-instance_method">
  
    - (<tt>void</tt>) <strong>default_options</strong>  <span class="extras">(readonly)</span>
  

  

  
    <span class="not_defined_here">
      Originally defined in class
        <span class='object_link'><a href="Abstract/ID.html#default_options-instance_method" title="Rack::Session::Abstract::ID#default_options (method)">Abstract::ID</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute default_options</p>


  </div>
</div>
<div class="tags">
  

</div>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="key-instance_method">
  
    - (<tt>void</tt>) <strong>key</strong>  <span class="extras">(readonly)</span>
  

  

  
    <span class="not_defined_here">
      Originally defined in class
        <span class='object_link'><a href="Abstract/ID.html#key-instance_method" title="Rack::Session::Abstract::ID#key (method)">Abstract::ID</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute key</p>


  </div>
</div>
<div class="tags">
  

</div>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="mutex-instance_method">
  
    - (<tt>void</tt>) <strong>mutex</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute mutex</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/memcache.rb', line 23</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mutex'>mutex</span>
  <span class='ivar'>@mutex</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="pool-instance_method">
  
    - (<tt>void</tt>) <strong>pool</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute pool</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/memcache.rb', line 23</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pool'>pool</span>
  <span class='ivar'>@pool</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="destroy_session-instance_method">
  
    - (<tt>void</tt>) <strong>destroy_session</strong>(env, session_id, options) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


71
72
73
74
75
76</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/memcache.rb', line 71</span>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy_session'>destroy_session</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_session_id'>session_id</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_with_lock'>with_lock</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_session_id'>session_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_generate_sid'>generate_sid</span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:drop</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="generate_sid-instance_method">
  
    - (<tt>void</tt>) <strong>generate_sid</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44
45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/memcache.rb', line 42</span>

<span class='kw'>def</span> <span class='id identifier rubyid_generate_sid'>generate_sid</span>
  <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_sid'>sid</span> <span class='op'>=</span> <span class='kw'>super</span>
    <span class='kw'>break</span> <span class='id identifier rubyid_sid'>sid</span> <span class='kw'>unless</span> <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='id identifier rubyid_sid'>sid</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_session-instance_method">
  
    - (<tt>void</tt>) <strong>get_session</strong>(env, sid) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51
52
53
54
55
56
57
58
59</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/memcache.rb', line 49</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_session'>get_session</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_sid'>sid</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_with_lock'>with_lock</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_sid'>sid</span> <span class='kw'>and</span> <span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='id identifier rubyid_sid'>sid</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_sid'>sid</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='id identifier rubyid_generate_sid'>generate_sid</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
      <span class='kw'>unless</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^STORED</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_sid'>sid</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Session collision on '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sid'>sid</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='lbracket'>[</span><span class='id identifier rubyid_sid'>sid</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_session-instance_method">
  
    - (<tt>void</tt>) <strong>set_session</strong>(env, session_id, new_session, options) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


61
62
63
64
65
66
67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/memcache.rb', line 61</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_session'>set_session</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_session_id'>session_id</span><span class='comma'>,</span> <span class='id identifier rubyid_new_session'>new_session</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_expiry'>expiry</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:expire_after</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_expiry'>expiry</span> <span class='op'>=</span> <span class='id identifier rubyid_expiry'>expiry</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='int'>0</span> <span class='op'>:</span> <span class='id identifier rubyid_expiry'>expiry</span> <span class='op'>+</span> <span class='int'>1</span>

  <span class='id identifier rubyid_with_lock'>with_lock</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span> <span class='id identifier rubyid_session_id'>session_id</span><span class='comma'>,</span> <span class='id identifier rubyid_new_session'>new_session</span><span class='comma'>,</span> <span class='id identifier rubyid_expiry'>expiry</span>
    <span class='id identifier rubyid_session_id'>session_id</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="with_lock-instance_method">
  
    - (<tt>void</tt>) <strong>with_lock</strong>(env, default = nil) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80
81
82
83
84
85
86
87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/memcache.rb', line 78</span>

<span class='kw'>def</span> <span class='id identifier rubyid_with_lock'>with_lock</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_default'>default</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='ivar'>@mutex</span><span class='period'>.</span><span class='id identifier rubyid_lock'>lock</span> <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rack.multithread</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='kw'>yield</span>
<span class='kw'>rescue</span> <span class='const'>MemCache</span><span class='op'>::</span><span class='const'>MemCacheError</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ECONNREFUSED</span>
  <span class='kw'>if</span> <span class='gvar'>$VERBOSE</span>
    <span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='rbrace'>}</span><span class='tstring_content'> is unable to find memcached server.</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_warn'>warn</span> <span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_default'>default</span>
<span class='kw'>ensure</span>
  <span class='ivar'>@mutex</span><span class='period'>.</span><span class='id identifier rubyid_unlock'>unlock</span> <span class='kw'>if</span> <span class='ivar'>@mutex</span><span class='period'>.</span><span class='id identifier rubyid_locked?'>locked?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri Feb 14 16:51:26 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.3 (ruby-1.9.3).
</div>

  </body>
</html>