<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Rack::Session::Cookie
  
    &mdash; Lucipher
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Rack.html" title="Rack (module)">Rack</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Session.html" title="Rack::Session (module)">Session</a></span></span>
     &raquo; 
    <span class="title">Cookie</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Rack::Session::Cookie
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Abstract/ID.html" title="Rack::Session::Abstract::ID (class)">Abstract::ID</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="Abstract/ID.html" title="Rack::Session::Abstract::ID (class)">Abstract::ID</a></span></li>
          
            <li class="next">Rack::Session::Cookie</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">rack/rack/session/cookie.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Rack::Session::Cookie provides simple cookie based session management. By
default, the session is a Ruby Hash stored as base64 encoded marshalled
data set to :key (default: rack.session). The object that encodes the
session data is configurable and must respond to <code>encode</code> and
<code>decode</code>. Both methods must take a string and return a string.</p>

<p>When the secret key is set, cookie data is checked for data integrity. The
old secret key is also accepted and allows graceful secret rotation.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby">use Rack::Session::Cookie, :key =&gt; 'rack.session',
                           :domain =&gt; 'foo.com',
                           :path =&gt; '/',
                           :expire_after =&gt; 2592000,
                           :secret =&gt; 'change_me',
                           :old_secret =&gt; 'also_change_me'

All parameters are optional.
</code></pre>

<p>Example of a cookie with no encoding:</p>

<p>Rack::Session::Cookie.new(application, {  :coder =&gt;
Rack::Session::Cookie::Identity.new  })</p>

<p>Example of a cookie with custom encoding:</p>

<p>Rack::Session::Cookie.new(application, {  :coder =&gt; Class.new {  def
encode(str); str.reverse; end  def decode(str); str.reverse; end  }.new  })</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Cookie/Base64.html" title="Rack::Session::Cookie::Base64 (class)">Base64</a></span>, <span class='object_link'><a href="Cookie/Identity.html" title="Rack::Session::Cookie::Identity (class)">Identity</a></span>, <span class='object_link'><a href="Cookie/Reverse.html" title="Rack::Session::Cookie::Reverse (class)">Reverse</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#coder-instance_method" title="#coder (instance method)">- (void) <strong>coder</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute coder.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_options-instance_method" title="#default_options (instance method)">- (void) <strong>default_options</strong> </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      inherited
      from <span class='object_link'><a href="Abstract/ID.html#default_options-instance_method" title="Rack::Session::Abstract::ID#default_options (method)">Abstract::ID</a></span>
    </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute default_options.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#key-instance_method" title="#key (instance method)">- (void) <strong>key</strong> </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      inherited
      from <span class='object_link'><a href="Abstract/ID.html#key-instance_method" title="Rack::Session::Abstract::ID#key (method)">Abstract::ID</a></span>
    </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute key.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#destroy_session-instance_method" title="#destroy_session (instance method)">- (void) <strong>destroy_session</strong>(env, session_id, options) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#digest_match%3F-instance_method" title="#digest_match? (instance method)">- (Boolean) <strong>digest_match?</strong>(data, digest) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#extract_session_id-instance_method" title="#extract_session_id (instance method)">- (void) <strong>extract_session_id</strong>(env) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#generate_hmac-instance_method" title="#generate_hmac (instance method)">- (void) <strong>generate_hmac</strong>(data, secret) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#get_session-instance_method" title="#get_session (instance method)">- (void) <strong>get_session</strong>(env, sid) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Cookie) <strong>initialize</strong>(app, options = {}) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of Cookie.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#persistent_session_id%21-instance_method" title="#persistent_session_id! (instance method)">- (void) <strong>persistent_session_id!</strong>(data, sid = nil) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#set_session-instance_method" title="#set_session (instance method)">- (void) <strong>set_session</strong>(env, session_id, session, options) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#unpacked_cookie_data-instance_method" title="#unpacked_cookie_data (instance method)">- (void) <strong>unpacked_cookie_data</strong>(env) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Rack::Session::Cookie (class)">Cookie</a></span></tt>) <strong>initialize</strong>(app, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of Cookie</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


97
98
99
100
101
102
103
104
105
106
107
108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/cookie.rb', line 97</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_app'>app</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@secrets</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_values_at'>values_at</span><span class='lparen'>(</span><span class='symbol'>:secret</span><span class='comma'>,</span> <span class='symbol'>:old_secret</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
  <span class='id identifier rubyid_warn'>warn</span> <span class='heredoc_beg'>&lt;&lt;-MSG</span> <span class='kw'>unless</span> <span class='ivar'>@secrets</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;=</span> <span class='int'>1</span>
<span class='tstring_content'>  SECURITY WARNING: No secret option provided to Rack::Session::Cookie.
  This poses a security threat. It is strongly recommended that you
  provide a secret to prevent exploits that may be possible from crafted
  cookies. This will not be supported in future versions of Rack, and
  future versions will even invalidate your existing user cookies.

  Called from: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_caller'>caller</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>.
</span><span class='heredoc_end'>  MSG
</span>  <span class='ivar'>@coder</span>  <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:coder</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'>Base64</span><span class='op'>::</span><span class='const'>Marshal</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_app'>app</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='symbol'>:cookie_only</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="coder-instance_method">
  
    - (<tt>void</tt>) <strong>coder</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute coder</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


95
96
97</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/cookie.rb', line 95</span>

<span class='kw'>def</span> <span class='id identifier rubyid_coder'>coder</span>
  <span class='ivar'>@coder</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="default_options-instance_method">
  
    - (<tt>void</tt>) <strong>default_options</strong>  <span class="extras">(readonly)</span>
  

  

  
    <span class="not_defined_here">
      Originally defined in class
        <span class='object_link'><a href="Abstract/ID.html#default_options-instance_method" title="Rack::Session::Abstract::ID#default_options (method)">Abstract::ID</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute default_options</p>


  </div>
</div>
<div class="tags">
  

</div>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="key-instance_method">
  
    - (<tt>void</tt>) <strong>key</strong>  <span class="extras">(readonly)</span>
  

  

  
    <span class="not_defined_here">
      Originally defined in class
        <span class='object_link'><a href="Abstract/ID.html#key-instance_method" title="Rack::Session::Abstract::ID#key (method)">Abstract::ID</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute key</p>


  </div>
</div>
<div class="tags">
  

</div>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="destroy_session-instance_method">
  
    - (<tt>void</tt>) <strong>destroy_session</strong>(env, session_id, options)  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


160
161
162
163</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/cookie.rb', line 160</span>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy_session'>destroy_session</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_session_id'>session_id</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='comment'># Nothing to do here, data is in the client
</span>  <span class='id identifier rubyid_generate_sid'>generate_sid</span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:drop</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="digest_match?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>digest_match?</strong>(data, digest)  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


165
166
167
168
169
170</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/cookie.rb', line 165</span>

<span class='kw'>def</span> <span class='id identifier rubyid_digest_match?'>digest_match?</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_digest'>digest</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_digest'>digest</span>
  <span class='ivar'>@secrets</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_secret'>secret</span><span class='op'>|</span>
    <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Utils</span><span class='period'>.</span><span class='id identifier rubyid_secure_compare'>secure_compare</span><span class='lparen'>(</span><span class='id identifier rubyid_digest'>digest</span><span class='comma'>,</span> <span class='id identifier rubyid_generate_hmac'>generate_hmac</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_secret'>secret</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="extract_session_id-instance_method">
  
    - (<tt>void</tt>) <strong>extract_session_id</strong>(env)  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


120
121
122</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/cookie.rb', line 120</span>

<span class='kw'>def</span> <span class='id identifier rubyid_extract_session_id'>extract_session_id</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_unpacked_cookie_data'>unpacked_cookie_data</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="generate_hmac-instance_method">
  
    - (<tt>void</tt>) <strong>generate_hmac</strong>(data, secret)  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/cookie.rb', line 172</span>

<span class='kw'>def</span> <span class='id identifier rubyid_generate_hmac'>generate_hmac</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_secret'>secret</span><span class='rparen'>)</span>
  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>HMAC</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA1</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='id identifier rubyid_secret'>secret</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_session-instance_method">
  
    - (<tt>void</tt>) <strong>get_session</strong>(env, sid)  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


114
115
116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/cookie.rb', line 114</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_session'>get_session</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_sid'>sid</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_unpacked_cookie_data'>unpacked_cookie_data</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_persistent_session_id!'>persistent_session_id!</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="persistent_session_id!-instance_method">
  
    - (<tt>void</tt>) <strong>persistent_session_id!</strong>(data, sid = nil)  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


138
139
140
141
142</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/cookie.rb', line 138</span>

<span class='kw'>def</span> <span class='id identifier rubyid_persistent_session_id!'>persistent_session_id!</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_sid'>sid</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_sid'>sid</span> <span class='op'>||</span> <span class='id identifier rubyid_generate_sid'>generate_sid</span>
  <span class='id identifier rubyid_data'>data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_session-instance_method">
  
    - (<tt>void</tt>) <strong>set_session</strong>(env, session_id, session, options)  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


144
145
146
147
148
149
150
151
152
153
154
155
156
157
158</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/cookie.rb', line 144</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_session'>set_session</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_session_id'>session_id</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_session_id'>session_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_session_data'>session_data</span> <span class='op'>=</span> <span class='id identifier rubyid_coder'>coder</span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='ivar'>@secrets</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='id identifier rubyid_session_data'>session_data</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_generate_hmac'>generate_hmac</span><span class='lparen'>(</span><span class='id identifier rubyid_session_data'>session_data</span><span class='comma'>,</span> <span class='ivar'>@secrets</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_session_data'>session_data</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='lparen'>(</span><span class='int'>4096</span> <span class='op'>-</span> <span class='ivar'>@key</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.errors</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Warning! Rack::Session::Cookie data size exceeds 4K.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>nil</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_session_data'>session_data</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="unpacked_cookie_data-instance_method">
  
    - (<tt>void</tt>) <strong>unpacked_cookie_data</strong>(env)  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


124
125
126
127
128
129
130
131
132
133
134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/session/cookie.rb', line 124</span>

<span class='kw'>def</span> <span class='id identifier rubyid_unpacked_cookie_data'>unpacked_cookie_data</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.session.unpacked_cookie_data</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='kw'>begin</span>
    <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_session_data'>session_data</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_cookies'>cookies</span><span class='lbracket'>[</span><span class='ivar'>@key</span><span class='rbracket'>]</span>

    <span class='kw'>if</span> <span class='ivar'>@secrets</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_session_data'>session_data</span>
      <span class='id identifier rubyid_session_data'>session_data</span><span class='comma'>,</span> <span class='id identifier rubyid_digest'>digest</span> <span class='op'>=</span> <span class='id identifier rubyid_session_data'>session_data</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_session_data'>session_data</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_digest_match?'>digest_match?</span><span class='lparen'>(</span><span class='id identifier rubyid_session_data'>session_data</span><span class='comma'>,</span> <span class='id identifier rubyid_digest'>digest</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_coder'>coder</span><span class='period'>.</span><span class='id identifier rubyid_decode'>decode</span><span class='lparen'>(</span><span class='id identifier rubyid_session_data'>session_data</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri Feb 14 16:57:34 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.3 (ruby-1.9.3).
</div>

  </body>
</html>