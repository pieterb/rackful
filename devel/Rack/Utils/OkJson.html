<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Rack::Utils::OkJson
  
    &mdash; Lucipher
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (O)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Rack.html" title="Rack (module)">Rack</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Utils.html" title="Rack::Utils (module)">Utils</a></span></span>
     &raquo; 
    <span class="title">OkJson</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: Rack::Utils::OkJson
  
  
  
</h1>

<dl class="box">
  
  
    
      <dt class="r1">Extended by:</dt>
      <dd class="r1"><span class='object_link'><a href="" title="Rack::Utils::OkJson (module)">OkJson</a></span></dd>
      
    
  
    
  
  
    <dt class="r2">Included in:</dt>
    <dd class="r2"><span class='object_link'><a href="" title="Rack::Utils::OkJson (module)">OkJson</a></span></dd>
    
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">rack/rack/utils/okjson.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Some parts adapted from <a
href="http://golang.org/src/pkg/json/decode.go">golang.org/src/pkg/json/decode.go</a>
and <a
href="http://golang.org/src/pkg/utf8/utf8.go">golang.org/src/pkg/utf8/utf8.go</a></p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="OkJson/Error.html" title="Rack::Utils::OkJson::Error (class)">Error</a></span>, <span class='object_link'><a href="OkJson/Utf8Error.html" title="Rack::Utils::OkJson::Utf8Error (class)">Utf8Error</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="Upstream-constant" class="">Upstream =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>LTD7LBKLZWFF7OZK</span><span class='tstring_end'>'</span></span></pre></dd>
      
        <dt id="Utagx-constant" class="">Utagx =
          
        </dt>
        <dd><pre class="code"><span class='int'>0x80</span></pre></dd>
      
        <dt id="Utag2-constant" class="">Utag2 =
          
        </dt>
        <dd><pre class="code"><span class='int'>0xc0</span></pre></dd>
      
        <dt id="Utag3-constant" class="">Utag3 =
          
        </dt>
        <dd><pre class="code"><span class='int'>0xe0</span></pre></dd>
      
        <dt id="Utag4-constant" class="">Utag4 =
          
        </dt>
        <dd><pre class="code"><span class='int'>0xf0</span></pre></dd>
      
        <dt id="Utag5-constant" class="">Utag5 =
          <div class="docstring">
  <div class="discussion">
    
<p>1000 0000 1100 0000 1110 0000 1111 0000 1111 1000</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0xF8</span></pre></dd>
      
        <dt id="Umaskx-constant" class="">Umaskx =
          
        </dt>
        <dd><pre class="code"><span class='int'>0x3f</span></pre></dd>
      
        <dt id="Umask2-constant" class="">Umask2 =
          
        </dt>
        <dd><pre class="code"><span class='int'>0x1f</span></pre></dd>
      
        <dt id="Umask3-constant" class="">Umask3 =
          
        </dt>
        <dd><pre class="code"><span class='int'>0x0f</span></pre></dd>
      
        <dt id="Umask4-constant" class="">Umask4 =
          <div class="docstring">
  <div class="discussion">
    
<p>0011 1111 0001 1111 0000 1111 0000 0111</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0x07</span></pre></dd>
      
        <dt id="Uchar1max-constant" class="">Uchar1max =
          
        </dt>
        <dd><pre class="code"><span class='lparen'>(</span><span class='int'>1</span><span class='op'>&lt;&lt;</span><span class='int'>7</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='int'>1</span></pre></dd>
      
        <dt id="Uchar2max-constant" class="">Uchar2max =
          
        </dt>
        <dd><pre class="code"><span class='lparen'>(</span><span class='int'>1</span><span class='op'>&lt;&lt;</span><span class='int'>11</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='int'>1</span></pre></dd>
      
        <dt id="Uchar3max-constant" class="">Uchar3max =
          
        </dt>
        <dd><pre class="code"><span class='lparen'>(</span><span class='int'>1</span><span class='op'>&lt;&lt;</span><span class='int'>16</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='int'>1</span></pre></dd>
      
        <dt id="Ucharerr-constant" class="">Ucharerr =
          <div class="docstring">
  <div class="discussion">
    
<p>unicode "replacement char"</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0xFFFD</span></pre></dd>
      
        <dt id="Ustrerr-constant" class="">Ustrerr =
          <div class="docstring">
  <div class="discussion">
    
<p>unicode "replacement char"</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xef\xbf\xbd</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="Usurrself-constant" class="">Usurrself =
          
        </dt>
        <dd><pre class="code"><span class='int'>0x10000</span></pre></dd>
      
        <dt id="Usurr1-constant" class="">Usurr1 =
          
        </dt>
        <dd><pre class="code"><span class='int'>0xd800</span></pre></dd>
      
        <dt id="Usurr2-constant" class="">Usurr2 =
          
        </dt>
        <dd><pre class="code"><span class='int'>0xdc00</span></pre></dd>
      
        <dt id="Usurr3-constant" class="">Usurr3 =
          
        </dt>
        <dd><pre class="code"><span class='int'>0xe000</span></pre></dd>
      
        <dt id="Spc-constant" class="">Spc =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> </span><span class='tstring_end'>'</span></span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span></pre></dd>
      
        <dt id="Unesc-constant" class="">Unesc =
          
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span><span class='CHAR'>?b</span><span class='op'>=&gt;</span><span class='CHAR'>?\b</span><span class='comma'>,</span> <span class='CHAR'>?f</span><span class='op'>=&gt;</span><span class='CHAR'>?\f</span><span class='comma'>,</span> <span class='CHAR'>?n</span><span class='op'>=&gt;</span><span class='CHAR'>?\n</span><span class='comma'>,</span> <span class='CHAR'>?r</span><span class='op'>=&gt;</span><span class='CHAR'>?\r</span><span class='comma'>,</span> <span class='CHAR'>?t</span><span class='op'>=&gt;</span><span class='CHAR'>?\t</span><span class='rbrace'>}</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#abbrev-class_method" title="#abbrev (class method)">+ (void) <strong>abbrev</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#arrenc-class_method" title="#arrenc (class method)">+ (void) <strong>arrenc</strong>(a) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#arrparse-class_method" title="#arrparse (class method)">+ (void) <strong>arrparse</strong>(ts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Parses an "array" in the sense of RFC 4627.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decode-class_method" title="#decode (class method)">+ (void) <strong>decode</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Decodes a json document in string s and returns the corresponding ruby
value.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#eat-class_method" title="#eat (class method)">+ (void) <strong>eat</strong>(typ, ts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#encode-class_method" title="#encode (class method)">+ (void) <strong>encode</strong>(x) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Encodes x into a json text.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#falsetok-class_method" title="#falsetok (class method)">+ (void) <strong>falsetok</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#hexdec4-class_method" title="#hexdec4 (class method)">+ (void) <strong>hexdec4</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#keyenc-class_method" title="#keyenc (class method)">+ (void) <strong>keyenc</strong>(k) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#lex-class_method" title="#lex (class method)">+ (void) <strong>lex</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Scans s and returns a list of json tokens, excluding white space (as
defined in RFC 4627).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#nibble-class_method" title="#nibble (class method)">+ (void) <strong>nibble</strong>(c) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#nulltok-class_method" title="#nulltok (class method)">+ (void) <strong>nulltok</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#numenc-class_method" title="#numenc (class method)">+ (void) <strong>numenc</strong>(x) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#numtok-class_method" title="#numtok (class method)">+ (void) <strong>numtok</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#objenc-class_method" title="#objenc (class method)">+ (void) <strong>objenc</strong>(x) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#objparse-class_method" title="#objparse (class method)">+ (void) <strong>objparse</strong>(ts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Parses an "object" in the sense of RFC 4627.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pairparse-class_method" title="#pairparse (class method)">+ (void) <strong>pairparse</strong>(ts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Parses a "member" in the sense of RFC 4627.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#strenc-class_method" title="#strenc (class method)">+ (void) <strong>strenc</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#strtok-class_method" title="#strtok (class method)">+ (void) <strong>strtok</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#subst-class_method" title="#subst (class method)">+ (void) <strong>subst</strong>(u1, u2) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#surrogate%3F-class_method" title="#surrogate? (class method)">+ (Boolean) <strong>surrogate?</strong>(u) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#textparse-class_method" title="#textparse (class method)">+ (void) <strong>textparse</strong>(ts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Parses a "json text" in the sense of RFC 4627.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tok-class_method" title="#tok (class method)">+ (void) <strong>tok</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Scans the first token in s and returns a 3-element list, or nil if s does
not begin with a valid token.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#truetok-class_method" title="#truetok (class method)">+ (void) <strong>truetok</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ucharcopy-class_method" title="#ucharcopy (class method)">+ (void) <strong>ucharcopy</strong>(t, s, i) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Copies the valid UTF-8 bytes of a single character from string s at
position i to I/O object t, and returns the number of bytes copied.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ucharenc-class_method" title="#ucharenc (class method)">+ (void) <strong>ucharenc</strong>(a, i, u) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Encodes unicode character u as UTF-8 bytes in string a at position i.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unquote-class_method" title="#unquote (class method)">+ (void) <strong>unquote</strong>(q) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Converts a quoted json string literal q into a UTF-8-encoded string.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valenc-class_method" title="#valenc (class method)">+ (void) <strong>valenc</strong>(x) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valparse-class_method" title="#valparse (class method)">+ (void) <strong>valparse</strong>(ts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Parses a "value" in the sense of RFC 4627.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#abbrev-instance_method" title="#abbrev (instance method)">- (void) <strong>abbrev</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#arrenc-instance_method" title="#arrenc (instance method)">- (void) <strong>arrenc</strong>(a) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#arrparse-instance_method" title="#arrparse (instance method)">- (void) <strong>arrparse</strong>(ts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Parses an "array" in the sense of RFC 4627.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decode-instance_method" title="#decode (instance method)">- (void) <strong>decode</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Decodes a json document in string s and returns the corresponding ruby
value.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#eat-instance_method" title="#eat (instance method)">- (void) <strong>eat</strong>(typ, ts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#encode-instance_method" title="#encode (instance method)">- (void) <strong>encode</strong>(x) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Encodes x into a json text.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#falsetok-instance_method" title="#falsetok (instance method)">- (void) <strong>falsetok</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#hexdec4-instance_method" title="#hexdec4 (instance method)">- (void) <strong>hexdec4</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#keyenc-instance_method" title="#keyenc (instance method)">- (void) <strong>keyenc</strong>(k) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#lex-instance_method" title="#lex (instance method)">- (void) <strong>lex</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Scans s and returns a list of json tokens, excluding white space (as
defined in RFC 4627).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#nibble-instance_method" title="#nibble (instance method)">- (void) <strong>nibble</strong>(c) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#nulltok-instance_method" title="#nulltok (instance method)">- (void) <strong>nulltok</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#numenc-instance_method" title="#numenc (instance method)">- (void) <strong>numenc</strong>(x) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#numtok-instance_method" title="#numtok (instance method)">- (void) <strong>numtok</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#objenc-instance_method" title="#objenc (instance method)">- (void) <strong>objenc</strong>(x) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#objparse-instance_method" title="#objparse (instance method)">- (void) <strong>objparse</strong>(ts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Parses an "object" in the sense of RFC 4627.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pairparse-instance_method" title="#pairparse (instance method)">- (void) <strong>pairparse</strong>(ts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Parses a "member" in the sense of RFC 4627.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#strenc-instance_method" title="#strenc (instance method)">- (void) <strong>strenc</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#strtok-instance_method" title="#strtok (instance method)">- (void) <strong>strtok</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#subst-instance_method" title="#subst (instance method)">- (void) <strong>subst</strong>(u1, u2) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#surrogate%3F-instance_method" title="#surrogate? (instance method)">- (Boolean) <strong>surrogate?</strong>(u) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#textparse-instance_method" title="#textparse (instance method)">- (void) <strong>textparse</strong>(ts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Parses a "json text" in the sense of RFC 4627.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tok-instance_method" title="#tok (instance method)">- (void) <strong>tok</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Scans the first token in s and returns a 3-element list, or nil if s does
not begin with a valid token.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#truetok-instance_method" title="#truetok (instance method)">- (void) <strong>truetok</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ucharcopy-instance_method" title="#ucharcopy (instance method)">- (void) <strong>ucharcopy</strong>(t, s, i) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Copies the valid UTF-8 bytes of a single character from string s at
position i to I/O object t, and returns the number of bytes copied.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ucharenc-instance_method" title="#ucharenc (instance method)">- (void) <strong>ucharenc</strong>(a, i, u) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Encodes unicode character u as UTF-8 bytes in string a at position i.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unquote-instance_method" title="#unquote (instance method)">- (void) <strong>unquote</strong>(q) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Converts a quoted json string literal q into a UTF-8-encoded string.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valenc-instance_method" title="#valenc (instance method)">- (void) <strong>valenc</strong>(x) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valparse-instance_method" title="#valparse (instance method)">- (void) <strong>valparse</strong>(ts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Parses a "value" in the sense of RFC 4627.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="abbrev-class_method">
  
    + (<tt>void</tt>) <strong>abbrev</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


255
256
257
258
259
260
261</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 255</span>

<span class='kw'>def</span> <span class='id identifier rubyid_abbrev'>abbrev</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>10</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>`</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='id identifier rubyid_p'>p</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_p'>p</span>
  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>...</span><span class='tstring_end'>'</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>`</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id identifier rubyid_t'>t</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>`</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="arrenc-class_method">
  
    + (<tt>void</tt>) <strong>arrenc</strong>(a) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


437
438
439</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 437</span>

<span class='kw'>def</span> <span class='id identifier rubyid_arrenc'>arrenc</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>[</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_valenc'>valenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>]</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="arrparse-class_method">
  
    + (<tt>void</tt>) <strong>arrparse</strong>(ts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Parses an "array" in the sense of RFC 4627. Returns the parsed value and
any trailing tokens.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 137</span>

<span class='kw'>def</span> <span class='id identifier rubyid_arrparse'>arrparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_eat'>eat</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>[</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_arr'>arr</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>]</span><span class='tstring_end'>'</span></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_arr'>arr</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_valparse'>valparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_arr'>arr</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_v'>v</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>]</span><span class='tstring_end'>'</span></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_arr'>arr</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_eat'>eat</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_valparse'>valparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arr'>arr</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_v'>v</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>]</span><span class='tstring_end'>'</span></span>
      <span class='kw'>return</span> <span class='id identifier rubyid_arr'>arr</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="decode-class_method">
  
    + (<tt>void</tt>) <strong>decode</strong>(s) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Decodes a json document in string s and returns the corresponding ruby
value. String s must be valid UTF-8. If you have a string in some other
encoding, convert it first.</p>

<p>String values in the resulting structure will be UTF-8.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47
48
49
50
51
52</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 45</span>

<span class='kw'>def</span> <span class='id identifier rubyid_decode'>decode</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_lex'>lex</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_textparse'>textparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>trailing garbage</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_v'>v</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="eat-class_method">
  
    + (<tt>void</tt>) <strong>eat</strong>(typ, ts) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


165
166
167
168
169
170</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 165</span>

<span class='kw'>def</span> <span class='id identifier rubyid_eat'>eat</span><span class='lparen'>(</span><span class='id identifier rubyid_typ'>typ</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='id identifier rubyid_typ'>typ</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>expected </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_typ'>typ</span><span class='rbrace'>}</span><span class='tstring_content'> (got </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="encode-class_method">
  
    + (<tt>void</tt>) <strong>encode</strong>(x) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Encodes x into a json text. It may contain only Array, Hash, String,
Numeric, true, false, nil. (Note, this list excludes Symbol.) X itself must
be an Array or a Hash. No other value can be encoded, and an error will be
raised if x contains any other value, such as Nan, Infinity, Symbol, and
Proc, or if a Hash key is not a String. Strings contained in x must be
valid UTF-8.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


407
408
409
410
411
412
413
414</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 407</span>

<span class='kw'>def</span> <span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_x'>x</span>
  <span class='kw'>when</span> <span class='const'>Hash</span>    <span class='kw'>then</span> <span class='id identifier rubyid_objenc'>objenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Array</span>   <span class='kw'>then</span> <span class='id identifier rubyid_arrenc'>arrenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>root value must be an Array or a Hash</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="falsetok-class_method">
  
    + (<tt>void</tt>) <strong>falsetok</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


227</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 227</span>

<span class='kw'>def</span> <span class='id identifier rubyid_falsetok'>falsetok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>5</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>false</span><span class='tstring_end'>'</span></span> <span class='op'>?</span> <span class='lbracket'>[</span><span class='symbol'>:val</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>false</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='kw'>false</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="hexdec4-class_method">
  
    + (<tt>void</tt>) <strong>hexdec4</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


366
367
368
369
370
371</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 366</span>

<span class='kw'>def</span> <span class='id identifier rubyid_hexdec4'>hexdec4</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>!=</span> <span class='int'>4</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>short</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_nibble'>nibble</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>12</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_nibble'>nibble</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>8</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_nibble'>nibble</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>4</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='id identifier rubyid_nibble'>nibble</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="keyenc-class_method">
  
    + (<tt>void</tt>) <strong>keyenc</strong>(k) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


442
443
444
445
446
447
448</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 442</span>

<span class='kw'>def</span> <span class='id identifier rubyid_keyenc'>keyenc</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_k'>k</span>
  <span class='kw'>when</span> <span class='const'>String</span> <span class='kw'>then</span> <span class='id identifier rubyid_strenc'>strenc</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hash key is not a string: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="lex-class_method">
  
    + (<tt>void</tt>) <strong>lex</strong>(s) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Scans s and returns a list of json tokens, excluding white space (as
defined in RFC 4627).</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


175
176
177
178
179
180
181
182
183
184
185
186
187
188</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 175</span>

<span class='kw'>def</span> <span class='id identifier rubyid_lex'>lex</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_typ'>typ</span><span class='comma'>,</span> <span class='id identifier rubyid_lexeme'>lexeme</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_tok'>tok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_typ'>typ</span> <span class='op'>==</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid character at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>10</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_typ'>typ</span> <span class='op'>!=</span> <span class='symbol'>:space</span>
      <span class='id identifier rubyid_ts'>ts</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_typ'>typ</span><span class='comma'>,</span> <span class='id identifier rubyid_lexeme'>lexeme</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_lexeme'>lexeme</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ts'>ts</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="nibble-class_method">
  
    + (<tt>void</tt>) <strong>nibble</strong>(c) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


387
388
389
390
391
392
393
394
395</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 387</span>

<span class='kw'>def</span> <span class='id identifier rubyid_nibble'>nibble</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='kw'>true</span>
  <span class='kw'>when</span> <span class='CHAR'>?0</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&lt;=</span> <span class='CHAR'>?9</span> <span class='kw'>then</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span> <span class='op'>-</span> <span class='CHAR'>?0</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
  <span class='kw'>when</span> <span class='CHAR'>?a</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&lt;=</span> <span class='CHAR'>?z</span> <span class='kw'>then</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span> <span class='op'>-</span> <span class='CHAR'>?a</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span> <span class='op'>+</span> <span class='int'>10</span>
  <span class='kw'>when</span> <span class='CHAR'>?A</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&lt;=</span> <span class='CHAR'>?Z</span> <span class='kw'>then</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span> <span class='op'>-</span> <span class='CHAR'>?A</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span> <span class='op'>+</span> <span class='int'>10</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid hex code </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="nulltok-class_method">
  
    + (<tt>void</tt>) <strong>nulltok</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


225</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 225</span>

<span class='kw'>def</span> <span class='id identifier rubyid_nulltok'>nulltok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>4</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>null</span><span class='tstring_end'>'</span></span>  <span class='op'>?</span> <span class='lbracket'>[</span><span class='symbol'>:val</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>null</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>  <span class='kw'>nil</span><span class='rbracket'>]</span>   <span class='op'>:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="numenc-class_method">
  
    + (<tt>void</tt>) <strong>numenc</strong>(x) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


492
493
494
495
496
497</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 492</span>

<span class='kw'>def</span> <span class='id identifier rubyid_numenc'>numenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_nan?'>nan?</span> <span class='op'>||</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_infinite?'>infinite?</span><span class='rparen'>)</span> <span class='kw'>rescue</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Numeric cannot be represented: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x'>x</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x'>x</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="numtok-class_method">
  
    + (<tt>void</tt>) <strong>numtok</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


230
231
232
233
234
235
236
237
238
239
240
241
242
243</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 230</span>

<span class='kw'>def</span> <span class='id identifier rubyid_numtok'>numtok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>-?([1-9][0-9]+|[0-9])([.][0-9]+)?([eE][+-]?[0-9]+)?</span><span class='regexp_end'>/</span></span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_m'>m</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_begin'>begin</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='lbracket'>[</span><span class='symbol'>:val</span><span class='comma'>,</span> <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='op'>*</span><span class='lparen'>(</span><span class='int'>10</span><span class='op'>**</span><span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rbracket'>]</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='lbracket'>[</span><span class='symbol'>:val</span><span class='comma'>,</span> <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rbracket'>]</span>
    <span class='kw'>else</span>
      <span class='lbracket'>[</span><span class='symbol'>:val</span><span class='comma'>,</span> <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="objenc-class_method">
  
    + (<tt>void</tt>) <strong>objenc</strong>(x) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


432
433
434</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 432</span>

<span class='kw'>def</span> <span class='id identifier rubyid_objenc'>objenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>{</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_keyenc'>keyenc</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id identifier rubyid_valenc'>valenc</span><span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>}</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="objparse-class_method">
  
    + (<tt>void</tt>) <strong>objparse</strong>(ts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Parses an "object" in the sense of RFC 4627. Returns the parsed value and
any trailing tokens.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 94</span>

<span class='kw'>def</span> <span class='id identifier rubyid_objparse'>objparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_eat'>eat</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>{</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>}</span><span class='tstring_end'>'</span></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_pairparse'>pairparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_obj'>obj</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>}</span><span class='tstring_end'>'</span></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_eat'>eat</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_pairparse'>pairparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_obj'>obj</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>}</span><span class='tstring_end'>'</span></span>
      <span class='kw'>return</span> <span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pairparse-class_method">
  
    + (<tt>void</tt>) <strong>pairparse</strong>(ts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Parses a "member" in the sense of RFC 4627. Returns the parsed values and
any trailing tokens.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


124
125
126
127
128
129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 124</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pairparse'>pairparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_typ'>typ</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_typ'>typ</span> <span class='op'>!=</span> <span class='symbol'>:str</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unexpected </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_eat'>eat</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_valparse'>valparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="strenc-class_method">
  
    + (<tt>void</tt>) <strong>strenc</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 451</span>

<span class='kw'>def</span> <span class='id identifier rubyid_strenc'>strenc</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='const'>StringIO</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='CHAR'>?&quot;</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='comment'># In ruby &gt;= 1.9, s[r] is a codepoint, not a byte.
</span>  <span class='id identifier rubyid_rubydoesenc'>rubydoesenc</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_method_defined?'>method_defined?</span><span class='lparen'>(</span><span class='symbol'>:encoding</span><span class='rparen'>)</span>

  <span class='kw'>while</span> <span class='id identifier rubyid_r'>r</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='CHAR'>?&quot;</span>  <span class='kw'>then</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\&quot;</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='CHAR'>?\\</span> <span class='kw'>then</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\\\</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='CHAR'>?\b</span> <span class='kw'>then</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\b</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='CHAR'>?\f</span> <span class='kw'>then</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\f</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='CHAR'>?\n</span> <span class='kw'>then</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\n</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='CHAR'>?\r</span> <span class='kw'>then</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\r</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='CHAR'>?\t</span> <span class='kw'>then</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\t</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='rbracket'>]</span>
      <span class='kw'>case</span> <span class='kw'>true</span>
      <span class='kw'>when</span> <span class='id identifier rubyid_rubydoesenc'>rubydoesenc</span>
        <span class='kw'>begin</span>
          <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span> <span class='comment'># will raise an error if c is invalid UTF-8
</span>          <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='rparen'>)</span>
        <span class='kw'>rescue</span>
          <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='const'>Ustrerr</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>when</span> <span class='const'>Spc</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&lt;=</span> <span class='CHAR'>?~</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_ucharcopy'>ucharcopy</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_r'>r</span><span class='rparen'>)</span> <span class='comment'># ensure valid UTF-8 output
</span>        <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>-</span> <span class='int'>1</span> <span class='comment'># r is incremented below
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='CHAR'>?&quot;</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="strtok-class_method">
  
    + (<tt>void</tt>) <strong>strtok</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


246
247
248
249
250
251
252</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 246</span>

<span class='kw'>def</span> <span class='id identifier rubyid_strtok'>strtok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&quot;([^&quot;\\]|\\[&quot;\/\\bfnrt]|\\u[0-9a-fA-F]{4})*&quot;</span><span class='regexp_end'>/</span></span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='op'>!</span> <span class='id identifier rubyid_m'>m</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid string literal at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_abbrev'>abbrev</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='lbracket'>[</span><span class='symbol'>:str</span><span class='comma'>,</span> <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_unquote'>unquote</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="subst-class_method">
  
    + (<tt>void</tt>) <strong>subst</strong>(u1, u2) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


374
375
376
377
378
379</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 374</span>

<span class='kw'>def</span> <span class='id identifier rubyid_subst'>subst</span><span class='lparen'>(</span><span class='id identifier rubyid_u1'>u1</span><span class='comma'>,</span> <span class='id identifier rubyid_u2'>u2</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Usurr1</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_u1'>u1</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_u1'>u1</span> <span class='op'>&lt;</span> <span class='const'>Usurr2</span> <span class='op'>&amp;&amp;</span> <span class='const'>Usurr2</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_u2'>u2</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_u2'>u2</span> <span class='op'>&lt;</span> <span class='const'>Usurr3</span>
    <span class='kw'>return</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_u1'>u1</span><span class='op'>-</span><span class='const'>Usurr1</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>10</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_u2'>u2</span><span class='op'>-</span><span class='const'>Usurr2</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='const'>Usurrself</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='const'>Ucharerr</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="surrogate?-class_method">
  
    + (<tt>Boolean</tt>) <strong>surrogate?</strong>(u) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


382
383
384</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 382</span>

<span class='kw'>def</span> <span class='id identifier rubyid_surrogate?'>surrogate?</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span>
  <span class='const'>Usurr1</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>&lt;</span> <span class='const'>Usurr3</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="textparse-class_method">
  
    + (<tt>void</tt>) <strong>textparse</strong>(ts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Parses a "json text" in the sense of RFC 4627. Returns the parsed value and
any trailing tokens. Note: this is almost the same as valparse, except that
it does not accept atomic values.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


59
60
61
62
63
64
65
66
67
68
69
70
71</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 59</span>

<span class='kw'>def</span> <span class='id identifier rubyid_textparse'>textparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>empty</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_typ'>typ</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_typ'>typ</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>{</span><span class='tstring_end'>'</span></span> <span class='kw'>then</span> <span class='id identifier rubyid_objparse'>objparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>[</span><span class='tstring_end'>'</span></span> <span class='kw'>then</span> <span class='id identifier rubyid_arrparse'>arrparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unexpected </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="tok-class_method">
  
    + (<tt>void</tt>) <strong>tok</strong>(s) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Scans the first token in s and returns a 3-element list, or nil if s does
not begin with a valid token.</p>

<p>The first list element is one of ''', ':', ',', '[', ']', :val, :str,
and :space.</p>

<p>The second element is the lexeme.</p>

<p>The third element is the value of the token for :val and :str, otherwise it
is the lexeme.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 204</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tok'>tok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?{</span>  <span class='kw'>then</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>{</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?}</span>  <span class='kw'>then</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>}</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?:</span>  <span class='kw'>then</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?,</span>  <span class='kw'>then</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?[</span>  <span class='kw'>then</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>[</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?]</span>  <span class='kw'>then</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>]</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?n</span>  <span class='kw'>then</span> <span class='id identifier rubyid_nulltok'>nulltok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='CHAR'>?t</span>  <span class='kw'>then</span> <span class='id identifier rubyid_truetok'>truetok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='CHAR'>?f</span>  <span class='kw'>then</span> <span class='id identifier rubyid_falsetok'>falsetok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='CHAR'>?&quot;</span>  <span class='kw'>then</span> <span class='id identifier rubyid_strtok'>strtok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Spc</span> <span class='kw'>then</span> <span class='lbracket'>[</span><span class='symbol'>:space</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?\t</span> <span class='kw'>then</span> <span class='lbracket'>[</span><span class='symbol'>:space</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?\n</span> <span class='kw'>then</span> <span class='lbracket'>[</span><span class='symbol'>:space</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?\r</span> <span class='kw'>then</span> <span class='lbracket'>[</span><span class='symbol'>:space</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>          <span class='id identifier rubyid_numtok'>numtok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="truetok-class_method">
  
    + (<tt>void</tt>) <strong>truetok</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_truetok'>truetok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>4</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>true</span><span class='tstring_end'>'</span></span>  <span class='op'>?</span> <span class='lbracket'>[</span><span class='symbol'>:val</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>true</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>  <span class='kw'>true</span><span class='rbracket'>]</span>  <span class='op'>:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ucharcopy-class_method">
  
    + (<tt>void</tt>) <strong>ucharcopy</strong>(t, s, i) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Copies the valid UTF-8 bytes of a single character from string s at
position i to I/O object t, and returns the number of bytes copied. If no
valid UTF-8 char exists at position i, ucharcopy writes Ustrerr and returns
1.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 505</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ucharcopy'>ucharcopy</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='id identifier rubyid_i'>i</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;</span> <span class='int'>1</span>

  <span class='id identifier rubyid_c0'>c0</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>

  <span class='comment'># 1-byte, 7-bit sequence?
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_c0'>c0</span> <span class='op'>&lt;</span> <span class='const'>Utagx</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c0'>c0</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_c0'>c0</span> <span class='op'>&lt;</span> <span class='const'>Utag2</span> <span class='comment'># unexpected continuation byte?
</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;</span> <span class='int'>2</span> <span class='comment'># need continuation byte
</span>  <span class='id identifier rubyid_c1'>c1</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_c1'>c1</span> <span class='op'>&lt;</span> <span class='const'>Utagx</span> <span class='op'>||</span> <span class='const'>Utag2</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_c1'>c1</span>

  <span class='comment'># 2-byte, 11-bit sequence?
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_c0'>c0</span> <span class='op'>&lt;</span> <span class='const'>Utag3</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_c0'>c0</span><span class='op'>&amp;</span><span class='const'>Umask2</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>6</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_c1'>c1</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>&lt;=</span> <span class='const'>Uchar1max</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c0'>c0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c1'>c1</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='int'>2</span>
  <span class='kw'>end</span>

  <span class='comment'># need second continuation byte
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;</span> <span class='int'>3</span>

  <span class='id identifier rubyid_c2'>c2</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_c2'>c2</span> <span class='op'>&lt;</span> <span class='const'>Utagx</span> <span class='op'>||</span> <span class='const'>Utag2</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_c2'>c2</span>

  <span class='comment'># 3-byte, 16-bit sequence?
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_c0'>c0</span> <span class='op'>&lt;</span> <span class='const'>Utag4</span>
    <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_c0'>c0</span><span class='op'>&amp;</span><span class='const'>Umask3</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>12</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_c1'>c1</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>6</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_c2'>c2</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>&lt;=</span> <span class='const'>Uchar2max</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c0'>c0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c1'>c1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c2'>c2</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='int'>3</span>
  <span class='kw'>end</span>

  <span class='comment'># need third continuation byte
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;</span> <span class='int'>4</span>
  <span class='id identifier rubyid_c3'>c3</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_c3'>c3</span> <span class='op'>&lt;</span> <span class='const'>Utagx</span> <span class='op'>||</span> <span class='const'>Utag2</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_c3'>c3</span>

  <span class='comment'># 4-byte, 21-bit sequence?
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_c0'>c0</span> <span class='op'>&lt;</span> <span class='const'>Utag5</span>
    <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_c0'>c0</span><span class='op'>&amp;</span><span class='const'>Umask4</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>18</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_c1'>c1</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>12</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_c2'>c2</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>6</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_c3'>c3</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>&lt;=</span> <span class='const'>Uchar3max</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c0'>c0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c1'>c1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c2'>c2</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c3'>c3</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='int'>4</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span>
<span class='kw'>rescue</span> <span class='const'>Utf8Error</span>
  <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='const'>Ustrerr</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='int'>1</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ucharenc-class_method">
  
    + (<tt>void</tt>) <strong>ucharenc</strong>(a, i, u) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Encodes unicode character u as UTF-8 bytes in string a at position i.
Returns the number of bytes written.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 342</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ucharenc'>ucharenc</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='kw'>true</span>
  <span class='kw'>when</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>&lt;=</span> <span class='const'>Uchar1max</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span> <span class='op'>&amp;</span> <span class='int'>0xff</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='int'>1</span>
  <span class='kw'>when</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>&lt;=</span> <span class='const'>Uchar2max</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utag2</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&gt;&gt;</span><span class='int'>6</span><span class='rparen'>)</span><span class='op'>&amp;</span><span class='int'>0xff</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utagx</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='int'>2</span>
  <span class='kw'>when</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>&lt;=</span> <span class='const'>Uchar3max</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utag3</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&gt;&gt;</span><span class='int'>12</span><span class='rparen'>)</span><span class='op'>&amp;</span><span class='int'>0xff</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utagx</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&gt;&gt;</span><span class='int'>6</span><span class='rparen'>)</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utagx</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='int'>3</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utag4</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&gt;&gt;</span><span class='int'>18</span><span class='rparen'>)</span><span class='op'>&amp;</span><span class='int'>0xff</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utagx</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&gt;&gt;</span><span class='int'>12</span><span class='rparen'>)</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utagx</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&gt;&gt;</span><span class='int'>6</span><span class='rparen'>)</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utagx</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='int'>4</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="unquote-class_method">
  
    + (<tt>void</tt>) <strong>unquote</strong>(q) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Converts a quoted json string literal q into a UTF-8-encoded string. The
rules are different than for Ruby, so we cannot use eval. Unquote will
raise an error if q contains control characters.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 267</span>

<span class='kw'>def</span> <span class='id identifier rubyid_unquote'>unquote</span><span class='lparen'>(</span><span class='id identifier rubyid_q'>q</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_q'>q</span> <span class='op'>=</span> <span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>...</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='id identifier rubyid_q'>q</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span> <span class='comment'># allocate a big enough string
</span>  <span class='id identifier rubyid_rubydoesenc'>rubydoesenc</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='comment'># In ruby &gt;= 1.9, a[w] is a codepoint, not a byte.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_method_defined?'>method_defined?</span><span class='lparen'>(</span><span class='symbol'>:force_encoding</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_force_encoding'>force_encoding</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_rubydoesenc'>rubydoesenc</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_w'>w</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_r'>r</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_q'>q</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='rbracket'>]</span>
    <span class='kw'>case</span> <span class='kw'>true</span>
    <span class='kw'>when</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>==</span> <span class='CHAR'>?\\</span>
      <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_r'>r</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_q'>q</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>string literal ends with a \&quot;\\\&quot;: \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_q'>q</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='kw'>case</span> <span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='rbracket'>]</span>
      <span class='kw'>when</span> <span class='CHAR'>?&quot;</span><span class='comma'>,</span><span class='CHAR'>?\\</span><span class='comma'>,</span><span class='CHAR'>?/</span><span class='comma'>,</span><span class='CHAR'>?'</span>
        <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_w'>w</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_w'>w</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>when</span> <span class='CHAR'>?b</span><span class='comma'>,</span><span class='CHAR'>?f</span><span class='comma'>,</span><span class='CHAR'>?n</span><span class='comma'>,</span><span class='CHAR'>?r</span><span class='comma'>,</span><span class='CHAR'>?t</span>
        <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_w'>w</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Unesc</span><span class='lbracket'>[</span><span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_w'>w</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>when</span> <span class='CHAR'>?u</span>
        <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_uchar'>uchar</span> <span class='op'>=</span> <span class='kw'>begin</span>
          <span class='id identifier rubyid_hexdec4'>hexdec4</span><span class='lparen'>(</span><span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='comma'>,</span><span class='int'>4</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>rescue</span> <span class='const'>RuntimeError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
          <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid escape sequence \\u</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='comma'>,</span><span class='int'>4</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>4</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_surrogate?'>surrogate?</span> <span class='id identifier rubyid_uchar'>uchar</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_q'>q</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_r'>r</span><span class='op'>+</span><span class='int'>6</span>
            <span class='id identifier rubyid_uchar1'>uchar1</span> <span class='op'>=</span> <span class='id identifier rubyid_hexdec4'>hexdec4</span><span class='lparen'>(</span><span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='op'>+</span><span class='int'>2</span><span class='comma'>,</span><span class='int'>4</span><span class='rbracket'>]</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_uchar'>uchar</span> <span class='op'>=</span> <span class='id identifier rubyid_subst'>subst</span><span class='lparen'>(</span><span class='id identifier rubyid_uchar'>uchar</span><span class='comma'>,</span> <span class='id identifier rubyid_uchar1'>uchar1</span><span class='rparen'>)</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_uchar'>uchar</span> <span class='op'>!=</span> <span class='const'>Ucharerr</span>
              <span class='comment'># A valid pair; consume.
</span>              <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>6</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_rubydoesenc'>rubydoesenc</span>
          <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_w'>w</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_uchar'>uchar</span>
          <span class='id identifier rubyid_w'>w</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_w'>w</span> <span class='op'>+=</span> <span class='id identifier rubyid_ucharenc'>ucharenc</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_uchar'>uchar</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid escape char </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'> in \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_q'>q</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>==</span> <span class='CHAR'>?&quot;</span><span class='comma'>,</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&lt;</span> <span class='const'>Spc</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid character in string literal \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_q'>q</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='comment'># Copy anything else byte-for-byte.
</span>      <span class='comment'># Valid UTF-8 will remain valid UTF-8.
</span>      <span class='comment'># Invalid UTF-8 will remain invalid UTF-8.
</span>      <span class='comment'># In ruby &gt;= 1.9, c is a codepoint, not a byte,
</span>      <span class='comment'># in which case this is still what we want.
</span>      <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_w'>w</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span>
      <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_w'>w</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='id identifier rubyid_w'>w</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="valenc-class_method">
  
    + (<tt>void</tt>) <strong>valenc</strong>(x) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


417
418
419
420
421
422
423
424
425
426
427
428
429</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 417</span>

<span class='kw'>def</span> <span class='id identifier rubyid_valenc'>valenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_x'>x</span>
  <span class='kw'>when</span> <span class='const'>Hash</span>    <span class='kw'>then</span> <span class='id identifier rubyid_objenc'>objenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Array</span>   <span class='kw'>then</span> <span class='id identifier rubyid_arrenc'>arrenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>String</span>  <span class='kw'>then</span> <span class='id identifier rubyid_strenc'>strenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Numeric</span> <span class='kw'>then</span> <span class='id identifier rubyid_numenc'>numenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='kw'>true</span>    <span class='kw'>then</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>true</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='kw'>false</span>   <span class='kw'>then</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>false</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='kw'>nil</span>     <span class='kw'>then</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>null</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cannot encode </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='rbrace'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="valparse-class_method">
  
    + (<tt>void</tt>) <strong>valparse</strong>(ts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Parses a "value" in the sense of RFC 4627. Returns the parsed value and any
trailing tokens.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 76</span>

<span class='kw'>def</span> <span class='id identifier rubyid_valparse'>valparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>empty</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_typ'>typ</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_typ'>typ</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>{</span><span class='tstring_end'>'</span></span> <span class='kw'>then</span> <span class='id identifier rubyid_objparse'>objparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>[</span><span class='tstring_end'>'</span></span> <span class='kw'>then</span> <span class='id identifier rubyid_arrparse'>arrparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:val</span><span class='comma'>,</span><span class='symbol'>:str</span> <span class='kw'>then</span> <span class='lbracket'>[</span><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unexpected </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="abbrev-instance_method">
  
    - (<tt>void</tt>) <strong>abbrev</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


255
256
257
258
259
260
261</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 255</span>

<span class='kw'>def</span> <span class='id identifier rubyid_abbrev'>abbrev</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>10</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>`</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='id identifier rubyid_p'>p</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_p'>p</span>
  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>...</span><span class='tstring_end'>'</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>`</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id identifier rubyid_t'>t</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>`</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="arrenc-instance_method">
  
    - (<tt>void</tt>) <strong>arrenc</strong>(a) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


437
438
439</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 437</span>

<span class='kw'>def</span> <span class='id identifier rubyid_arrenc'>arrenc</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>[</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_valenc'>valenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>]</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="arrparse-instance_method">
  
    - (<tt>void</tt>) <strong>arrparse</strong>(ts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Parses an "array" in the sense of RFC 4627. Returns the parsed value and
any trailing tokens.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 137</span>

<span class='kw'>def</span> <span class='id identifier rubyid_arrparse'>arrparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_eat'>eat</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>[</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_arr'>arr</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>]</span><span class='tstring_end'>'</span></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_arr'>arr</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_valparse'>valparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_arr'>arr</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_v'>v</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>]</span><span class='tstring_end'>'</span></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_arr'>arr</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_eat'>eat</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_valparse'>valparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arr'>arr</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_v'>v</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>]</span><span class='tstring_end'>'</span></span>
      <span class='kw'>return</span> <span class='id identifier rubyid_arr'>arr</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="decode-instance_method">
  
    - (<tt>void</tt>) <strong>decode</strong>(s) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Decodes a json document in string s and returns the corresponding ruby
value. String s must be valid UTF-8. If you have a string in some other
encoding, convert it first.</p>

<p>String values in the resulting structure will be UTF-8.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47
48
49
50
51
52</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 45</span>

<span class='kw'>def</span> <span class='id identifier rubyid_decode'>decode</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_lex'>lex</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_textparse'>textparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>trailing garbage</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_v'>v</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="eat-instance_method">
  
    - (<tt>void</tt>) <strong>eat</strong>(typ, ts) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


165
166
167
168
169
170</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 165</span>

<span class='kw'>def</span> <span class='id identifier rubyid_eat'>eat</span><span class='lparen'>(</span><span class='id identifier rubyid_typ'>typ</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='id identifier rubyid_typ'>typ</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>expected </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_typ'>typ</span><span class='rbrace'>}</span><span class='tstring_content'> (got </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="encode-instance_method">
  
    - (<tt>void</tt>) <strong>encode</strong>(x) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Encodes x into a json text. It may contain only Array, Hash, String,
Numeric, true, false, nil. (Note, this list excludes Symbol.) X itself must
be an Array or a Hash. No other value can be encoded, and an error will be
raised if x contains any other value, such as Nan, Infinity, Symbol, and
Proc, or if a Hash key is not a String. Strings contained in x must be
valid UTF-8.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


407
408
409
410
411
412
413
414</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 407</span>

<span class='kw'>def</span> <span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_x'>x</span>
  <span class='kw'>when</span> <span class='const'>Hash</span>    <span class='kw'>then</span> <span class='id identifier rubyid_objenc'>objenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Array</span>   <span class='kw'>then</span> <span class='id identifier rubyid_arrenc'>arrenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>root value must be an Array or a Hash</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="falsetok-instance_method">
  
    - (<tt>void</tt>) <strong>falsetok</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


227</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 227</span>

<span class='kw'>def</span> <span class='id identifier rubyid_falsetok'>falsetok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>5</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>false</span><span class='tstring_end'>'</span></span> <span class='op'>?</span> <span class='lbracket'>[</span><span class='symbol'>:val</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>false</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='kw'>false</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="hexdec4-instance_method">
  
    - (<tt>void</tt>) <strong>hexdec4</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


366
367
368
369
370
371</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 366</span>

<span class='kw'>def</span> <span class='id identifier rubyid_hexdec4'>hexdec4</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>!=</span> <span class='int'>4</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>short</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_nibble'>nibble</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>12</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_nibble'>nibble</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>8</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_nibble'>nibble</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>4</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='id identifier rubyid_nibble'>nibble</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="keyenc-instance_method">
  
    - (<tt>void</tt>) <strong>keyenc</strong>(k) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


442
443
444
445
446
447
448</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 442</span>

<span class='kw'>def</span> <span class='id identifier rubyid_keyenc'>keyenc</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_k'>k</span>
  <span class='kw'>when</span> <span class='const'>String</span> <span class='kw'>then</span> <span class='id identifier rubyid_strenc'>strenc</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hash key is not a string: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="lex-instance_method">
  
    - (<tt>void</tt>) <strong>lex</strong>(s) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Scans s and returns a list of json tokens, excluding white space (as
defined in RFC 4627).</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


175
176
177
178
179
180
181
182
183
184
185
186
187
188</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 175</span>

<span class='kw'>def</span> <span class='id identifier rubyid_lex'>lex</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_typ'>typ</span><span class='comma'>,</span> <span class='id identifier rubyid_lexeme'>lexeme</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_tok'>tok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_typ'>typ</span> <span class='op'>==</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid character at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>10</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_typ'>typ</span> <span class='op'>!=</span> <span class='symbol'>:space</span>
      <span class='id identifier rubyid_ts'>ts</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_typ'>typ</span><span class='comma'>,</span> <span class='id identifier rubyid_lexeme'>lexeme</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_lexeme'>lexeme</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ts'>ts</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="nibble-instance_method">
  
    - (<tt>void</tt>) <strong>nibble</strong>(c) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


387
388
389
390
391
392
393
394
395</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 387</span>

<span class='kw'>def</span> <span class='id identifier rubyid_nibble'>nibble</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='kw'>true</span>
  <span class='kw'>when</span> <span class='CHAR'>?0</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&lt;=</span> <span class='CHAR'>?9</span> <span class='kw'>then</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span> <span class='op'>-</span> <span class='CHAR'>?0</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
  <span class='kw'>when</span> <span class='CHAR'>?a</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&lt;=</span> <span class='CHAR'>?z</span> <span class='kw'>then</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span> <span class='op'>-</span> <span class='CHAR'>?a</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span> <span class='op'>+</span> <span class='int'>10</span>
  <span class='kw'>when</span> <span class='CHAR'>?A</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&lt;=</span> <span class='CHAR'>?Z</span> <span class='kw'>then</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span> <span class='op'>-</span> <span class='CHAR'>?A</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span> <span class='op'>+</span> <span class='int'>10</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid hex code </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="nulltok-instance_method">
  
    - (<tt>void</tt>) <strong>nulltok</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


225</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 225</span>

<span class='kw'>def</span> <span class='id identifier rubyid_nulltok'>nulltok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>4</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>null</span><span class='tstring_end'>'</span></span>  <span class='op'>?</span> <span class='lbracket'>[</span><span class='symbol'>:val</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>null</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>  <span class='kw'>nil</span><span class='rbracket'>]</span>   <span class='op'>:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="numenc-instance_method">
  
    - (<tt>void</tt>) <strong>numenc</strong>(x) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


492
493
494
495
496
497</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 492</span>

<span class='kw'>def</span> <span class='id identifier rubyid_numenc'>numenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_nan?'>nan?</span> <span class='op'>||</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_infinite?'>infinite?</span><span class='rparen'>)</span> <span class='kw'>rescue</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Numeric cannot be represented: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x'>x</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x'>x</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="numtok-instance_method">
  
    - (<tt>void</tt>) <strong>numtok</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


230
231
232
233
234
235
236
237
238
239
240
241
242
243</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 230</span>

<span class='kw'>def</span> <span class='id identifier rubyid_numtok'>numtok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>-?([1-9][0-9]+|[0-9])([.][0-9]+)?([eE][+-]?[0-9]+)?</span><span class='regexp_end'>/</span></span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_m'>m</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_begin'>begin</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='lbracket'>[</span><span class='symbol'>:val</span><span class='comma'>,</span> <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='op'>*</span><span class='lparen'>(</span><span class='int'>10</span><span class='op'>**</span><span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rbracket'>]</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='lbracket'>[</span><span class='symbol'>:val</span><span class='comma'>,</span> <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rbracket'>]</span>
    <span class='kw'>else</span>
      <span class='lbracket'>[</span><span class='symbol'>:val</span><span class='comma'>,</span> <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="objenc-instance_method">
  
    - (<tt>void</tt>) <strong>objenc</strong>(x) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


432
433
434</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 432</span>

<span class='kw'>def</span> <span class='id identifier rubyid_objenc'>objenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>{</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_keyenc'>keyenc</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id identifier rubyid_valenc'>valenc</span><span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>}</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="objparse-instance_method">
  
    - (<tt>void</tt>) <strong>objparse</strong>(ts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Parses an "object" in the sense of RFC 4627. Returns the parsed value and
any trailing tokens.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 94</span>

<span class='kw'>def</span> <span class='id identifier rubyid_objparse'>objparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_eat'>eat</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>{</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>}</span><span class='tstring_end'>'</span></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_pairparse'>pairparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_obj'>obj</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>}</span><span class='tstring_end'>'</span></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_eat'>eat</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_pairparse'>pairparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_obj'>obj</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>}</span><span class='tstring_end'>'</span></span>
      <span class='kw'>return</span> <span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pairparse-instance_method">
  
    - (<tt>void</tt>) <strong>pairparse</strong>(ts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Parses a "member" in the sense of RFC 4627. Returns the parsed values and
any trailing tokens.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


124
125
126
127
128
129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 124</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pairparse'>pairparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_typ'>typ</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_typ'>typ</span> <span class='op'>!=</span> <span class='symbol'>:str</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unexpected </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_eat'>eat</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_valparse'>valparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="strenc-instance_method">
  
    - (<tt>void</tt>) <strong>strenc</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 451</span>

<span class='kw'>def</span> <span class='id identifier rubyid_strenc'>strenc</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='const'>StringIO</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='CHAR'>?&quot;</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='comment'># In ruby &gt;= 1.9, s[r] is a codepoint, not a byte.
</span>  <span class='id identifier rubyid_rubydoesenc'>rubydoesenc</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_method_defined?'>method_defined?</span><span class='lparen'>(</span><span class='symbol'>:encoding</span><span class='rparen'>)</span>

  <span class='kw'>while</span> <span class='id identifier rubyid_r'>r</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='CHAR'>?&quot;</span>  <span class='kw'>then</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\&quot;</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='CHAR'>?\\</span> <span class='kw'>then</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\\\</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='CHAR'>?\b</span> <span class='kw'>then</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\b</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='CHAR'>?\f</span> <span class='kw'>then</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\f</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='CHAR'>?\n</span> <span class='kw'>then</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\n</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='CHAR'>?\r</span> <span class='kw'>then</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\r</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='CHAR'>?\t</span> <span class='kw'>then</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\t</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='rbracket'>]</span>
      <span class='kw'>case</span> <span class='kw'>true</span>
      <span class='kw'>when</span> <span class='id identifier rubyid_rubydoesenc'>rubydoesenc</span>
        <span class='kw'>begin</span>
          <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span> <span class='comment'># will raise an error if c is invalid UTF-8
</span>          <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='rparen'>)</span>
        <span class='kw'>rescue</span>
          <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='const'>Ustrerr</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>when</span> <span class='const'>Spc</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&lt;=</span> <span class='CHAR'>?~</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_ucharcopy'>ucharcopy</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_r'>r</span><span class='rparen'>)</span> <span class='comment'># ensure valid UTF-8 output
</span>        <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>-</span> <span class='int'>1</span> <span class='comment'># r is incremented below
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='CHAR'>?&quot;</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="strtok-instance_method">
  
    - (<tt>void</tt>) <strong>strtok</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


246
247
248
249
250
251
252</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 246</span>

<span class='kw'>def</span> <span class='id identifier rubyid_strtok'>strtok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&quot;([^&quot;\\]|\\[&quot;\/\\bfnrt]|\\u[0-9a-fA-F]{4})*&quot;</span><span class='regexp_end'>/</span></span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='op'>!</span> <span class='id identifier rubyid_m'>m</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid string literal at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_abbrev'>abbrev</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='lbracket'>[</span><span class='symbol'>:str</span><span class='comma'>,</span> <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_unquote'>unquote</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="subst-instance_method">
  
    - (<tt>void</tt>) <strong>subst</strong>(u1, u2) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


374
375
376
377
378
379</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 374</span>

<span class='kw'>def</span> <span class='id identifier rubyid_subst'>subst</span><span class='lparen'>(</span><span class='id identifier rubyid_u1'>u1</span><span class='comma'>,</span> <span class='id identifier rubyid_u2'>u2</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Usurr1</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_u1'>u1</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_u1'>u1</span> <span class='op'>&lt;</span> <span class='const'>Usurr2</span> <span class='op'>&amp;&amp;</span> <span class='const'>Usurr2</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_u2'>u2</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_u2'>u2</span> <span class='op'>&lt;</span> <span class='const'>Usurr3</span>
    <span class='kw'>return</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_u1'>u1</span><span class='op'>-</span><span class='const'>Usurr1</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>10</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_u2'>u2</span><span class='op'>-</span><span class='const'>Usurr2</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='const'>Usurrself</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='const'>Ucharerr</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="surrogate?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>surrogate?</strong>(u) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


382
383
384</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 382</span>

<span class='kw'>def</span> <span class='id identifier rubyid_surrogate?'>surrogate?</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span>
  <span class='const'>Usurr1</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>&lt;</span> <span class='const'>Usurr3</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="textparse-instance_method">
  
    - (<tt>void</tt>) <strong>textparse</strong>(ts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Parses a "json text" in the sense of RFC 4627. Returns the parsed value and
any trailing tokens. Note: this is almost the same as valparse, except that
it does not accept atomic values.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


59
60
61
62
63
64
65
66
67
68
69
70
71</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 59</span>

<span class='kw'>def</span> <span class='id identifier rubyid_textparse'>textparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>empty</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_typ'>typ</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_typ'>typ</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>{</span><span class='tstring_end'>'</span></span> <span class='kw'>then</span> <span class='id identifier rubyid_objparse'>objparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>[</span><span class='tstring_end'>'</span></span> <span class='kw'>then</span> <span class='id identifier rubyid_arrparse'>arrparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unexpected </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="tok-instance_method">
  
    - (<tt>void</tt>) <strong>tok</strong>(s) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Scans the first token in s and returns a 3-element list, or nil if s does
not begin with a valid token.</p>

<p>The first list element is one of ''', ':', ',', '[', ']', :val, :str,
and :space.</p>

<p>The second element is the lexeme.</p>

<p>The third element is the value of the token for :val and :str, otherwise it
is the lexeme.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 204</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tok'>tok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?{</span>  <span class='kw'>then</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>{</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?}</span>  <span class='kw'>then</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>}</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?:</span>  <span class='kw'>then</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?,</span>  <span class='kw'>then</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?[</span>  <span class='kw'>then</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>[</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?]</span>  <span class='kw'>then</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>]</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?n</span>  <span class='kw'>then</span> <span class='id identifier rubyid_nulltok'>nulltok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='CHAR'>?t</span>  <span class='kw'>then</span> <span class='id identifier rubyid_truetok'>truetok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='CHAR'>?f</span>  <span class='kw'>then</span> <span class='id identifier rubyid_falsetok'>falsetok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='CHAR'>?&quot;</span>  <span class='kw'>then</span> <span class='id identifier rubyid_strtok'>strtok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Spc</span> <span class='kw'>then</span> <span class='lbracket'>[</span><span class='symbol'>:space</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?\t</span> <span class='kw'>then</span> <span class='lbracket'>[</span><span class='symbol'>:space</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?\n</span> <span class='kw'>then</span> <span class='lbracket'>[</span><span class='symbol'>:space</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='CHAR'>?\r</span> <span class='kw'>then</span> <span class='lbracket'>[</span><span class='symbol'>:space</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>          <span class='id identifier rubyid_numtok'>numtok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="truetok-instance_method">
  
    - (<tt>void</tt>) <strong>truetok</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_truetok'>truetok</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>4</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>true</span><span class='tstring_end'>'</span></span>  <span class='op'>?</span> <span class='lbracket'>[</span><span class='symbol'>:val</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>true</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>  <span class='kw'>true</span><span class='rbracket'>]</span>  <span class='op'>:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ucharcopy-instance_method">
  
    - (<tt>void</tt>) <strong>ucharcopy</strong>(t, s, i) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Copies the valid UTF-8 bytes of a single character from string s at
position i to I/O object t, and returns the number of bytes copied. If no
valid UTF-8 char exists at position i, ucharcopy writes Ustrerr and returns
1.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 505</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ucharcopy'>ucharcopy</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='id identifier rubyid_i'>i</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;</span> <span class='int'>1</span>

  <span class='id identifier rubyid_c0'>c0</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>

  <span class='comment'># 1-byte, 7-bit sequence?
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_c0'>c0</span> <span class='op'>&lt;</span> <span class='const'>Utagx</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c0'>c0</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_c0'>c0</span> <span class='op'>&lt;</span> <span class='const'>Utag2</span> <span class='comment'># unexpected continuation byte?
</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;</span> <span class='int'>2</span> <span class='comment'># need continuation byte
</span>  <span class='id identifier rubyid_c1'>c1</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_c1'>c1</span> <span class='op'>&lt;</span> <span class='const'>Utagx</span> <span class='op'>||</span> <span class='const'>Utag2</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_c1'>c1</span>

  <span class='comment'># 2-byte, 11-bit sequence?
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_c0'>c0</span> <span class='op'>&lt;</span> <span class='const'>Utag3</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_c0'>c0</span><span class='op'>&amp;</span><span class='const'>Umask2</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>6</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_c1'>c1</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>&lt;=</span> <span class='const'>Uchar1max</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c0'>c0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c1'>c1</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='int'>2</span>
  <span class='kw'>end</span>

  <span class='comment'># need second continuation byte
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;</span> <span class='int'>3</span>

  <span class='id identifier rubyid_c2'>c2</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_c2'>c2</span> <span class='op'>&lt;</span> <span class='const'>Utagx</span> <span class='op'>||</span> <span class='const'>Utag2</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_c2'>c2</span>

  <span class='comment'># 3-byte, 16-bit sequence?
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_c0'>c0</span> <span class='op'>&lt;</span> <span class='const'>Utag4</span>
    <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_c0'>c0</span><span class='op'>&amp;</span><span class='const'>Umask3</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>12</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_c1'>c1</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>6</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_c2'>c2</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>&lt;=</span> <span class='const'>Uchar2max</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c0'>c0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c1'>c1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c2'>c2</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='int'>3</span>
  <span class='kw'>end</span>

  <span class='comment'># need third continuation byte
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;</span> <span class='int'>4</span>
  <span class='id identifier rubyid_c3'>c3</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_c3'>c3</span> <span class='op'>&lt;</span> <span class='const'>Utagx</span> <span class='op'>||</span> <span class='const'>Utag2</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_c3'>c3</span>

  <span class='comment'># 4-byte, 21-bit sequence?
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_c0'>c0</span> <span class='op'>&lt;</span> <span class='const'>Utag5</span>
    <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_c0'>c0</span><span class='op'>&amp;</span><span class='const'>Umask4</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>18</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_c1'>c1</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>12</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_c2'>c2</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='op'>&lt;&lt;</span><span class='int'>6</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_c3'>c3</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span> <span class='kw'>if</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>&lt;=</span> <span class='const'>Uchar3max</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c0'>c0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c1'>c1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c2'>c2</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_putc'>putc</span><span class='lparen'>(</span><span class='id identifier rubyid_c3'>c3</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='int'>4</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Utf8Error</span>
<span class='kw'>rescue</span> <span class='const'>Utf8Error</span>
  <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='const'>Ustrerr</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='int'>1</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ucharenc-instance_method">
  
    - (<tt>void</tt>) <strong>ucharenc</strong>(a, i, u) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Encodes unicode character u as UTF-8 bytes in string a at position i.
Returns the number of bytes written.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 342</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ucharenc'>ucharenc</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='kw'>true</span>
  <span class='kw'>when</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>&lt;=</span> <span class='const'>Uchar1max</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span> <span class='op'>&amp;</span> <span class='int'>0xff</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='int'>1</span>
  <span class='kw'>when</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>&lt;=</span> <span class='const'>Uchar2max</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utag2</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&gt;&gt;</span><span class='int'>6</span><span class='rparen'>)</span><span class='op'>&amp;</span><span class='int'>0xff</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utagx</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='int'>2</span>
  <span class='kw'>when</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>&lt;=</span> <span class='const'>Uchar3max</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utag3</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&gt;&gt;</span><span class='int'>12</span><span class='rparen'>)</span><span class='op'>&amp;</span><span class='int'>0xff</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utagx</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&gt;&gt;</span><span class='int'>6</span><span class='rparen'>)</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utagx</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='int'>3</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utag4</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&gt;&gt;</span><span class='int'>18</span><span class='rparen'>)</span><span class='op'>&amp;</span><span class='int'>0xff</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utagx</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&gt;&gt;</span><span class='int'>12</span><span class='rparen'>)</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utagx</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&gt;&gt;</span><span class='int'>6</span><span class='rparen'>)</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Utagx</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='op'>&amp;</span><span class='const'>Umaskx</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='int'>4</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="unquote-instance_method">
  
    - (<tt>void</tt>) <strong>unquote</strong>(q) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Converts a quoted json string literal q into a UTF-8-encoded string. The
rules are different than for Ruby, so we cannot use eval. Unquote will
raise an error if q contains control characters.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 267</span>

<span class='kw'>def</span> <span class='id identifier rubyid_unquote'>unquote</span><span class='lparen'>(</span><span class='id identifier rubyid_q'>q</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_q'>q</span> <span class='op'>=</span> <span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>...</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='id identifier rubyid_q'>q</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span> <span class='comment'># allocate a big enough string
</span>  <span class='id identifier rubyid_rubydoesenc'>rubydoesenc</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='comment'># In ruby &gt;= 1.9, a[w] is a codepoint, not a byte.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_method_defined?'>method_defined?</span><span class='lparen'>(</span><span class='symbol'>:force_encoding</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_force_encoding'>force_encoding</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_rubydoesenc'>rubydoesenc</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_w'>w</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_r'>r</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_q'>q</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='rbracket'>]</span>
    <span class='kw'>case</span> <span class='kw'>true</span>
    <span class='kw'>when</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>==</span> <span class='CHAR'>?\\</span>
      <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_r'>r</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_q'>q</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>string literal ends with a \&quot;\\\&quot;: \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_q'>q</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='kw'>case</span> <span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='rbracket'>]</span>
      <span class='kw'>when</span> <span class='CHAR'>?&quot;</span><span class='comma'>,</span><span class='CHAR'>?\\</span><span class='comma'>,</span><span class='CHAR'>?/</span><span class='comma'>,</span><span class='CHAR'>?'</span>
        <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_w'>w</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_w'>w</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>when</span> <span class='CHAR'>?b</span><span class='comma'>,</span><span class='CHAR'>?f</span><span class='comma'>,</span><span class='CHAR'>?n</span><span class='comma'>,</span><span class='CHAR'>?r</span><span class='comma'>,</span><span class='CHAR'>?t</span>
        <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_w'>w</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Unesc</span><span class='lbracket'>[</span><span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_w'>w</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>when</span> <span class='CHAR'>?u</span>
        <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_uchar'>uchar</span> <span class='op'>=</span> <span class='kw'>begin</span>
          <span class='id identifier rubyid_hexdec4'>hexdec4</span><span class='lparen'>(</span><span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='comma'>,</span><span class='int'>4</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>rescue</span> <span class='const'>RuntimeError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
          <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid escape sequence \\u</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='comma'>,</span><span class='int'>4</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>4</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_surrogate?'>surrogate?</span> <span class='id identifier rubyid_uchar'>uchar</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_q'>q</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_r'>r</span><span class='op'>+</span><span class='int'>6</span>
            <span class='id identifier rubyid_uchar1'>uchar1</span> <span class='op'>=</span> <span class='id identifier rubyid_hexdec4'>hexdec4</span><span class='lparen'>(</span><span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='op'>+</span><span class='int'>2</span><span class='comma'>,</span><span class='int'>4</span><span class='rbracket'>]</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_uchar'>uchar</span> <span class='op'>=</span> <span class='id identifier rubyid_subst'>subst</span><span class='lparen'>(</span><span class='id identifier rubyid_uchar'>uchar</span><span class='comma'>,</span> <span class='id identifier rubyid_uchar1'>uchar1</span><span class='rparen'>)</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_uchar'>uchar</span> <span class='op'>!=</span> <span class='const'>Ucharerr</span>
              <span class='comment'># A valid pair; consume.
</span>              <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>6</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_rubydoesenc'>rubydoesenc</span>
          <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_w'>w</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_uchar'>uchar</span>
          <span class='id identifier rubyid_w'>w</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_w'>w</span> <span class='op'>+=</span> <span class='id identifier rubyid_ucharenc'>ucharenc</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_uchar'>uchar</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid escape char </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_q'>q</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'> in \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_q'>q</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>==</span> <span class='CHAR'>?&quot;</span><span class='comma'>,</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&lt;</span> <span class='const'>Spc</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid character in string literal \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_q'>q</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='comment'># Copy anything else byte-for-byte.
</span>      <span class='comment'># Valid UTF-8 will remain valid UTF-8.
</span>      <span class='comment'># Invalid UTF-8 will remain invalid UTF-8.
</span>      <span class='comment'># In ruby &gt;= 1.9, c is a codepoint, not a byte,
</span>      <span class='comment'># in which case this is still what we want.
</span>      <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_w'>w</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span>
      <span class='id identifier rubyid_r'>r</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_w'>w</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='id identifier rubyid_w'>w</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="valenc-instance_method">
  
    - (<tt>void</tt>) <strong>valenc</strong>(x) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


417
418
419
420
421
422
423
424
425
426
427
428
429</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 417</span>

<span class='kw'>def</span> <span class='id identifier rubyid_valenc'>valenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_x'>x</span>
  <span class='kw'>when</span> <span class='const'>Hash</span>    <span class='kw'>then</span> <span class='id identifier rubyid_objenc'>objenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Array</span>   <span class='kw'>then</span> <span class='id identifier rubyid_arrenc'>arrenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>String</span>  <span class='kw'>then</span> <span class='id identifier rubyid_strenc'>strenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Numeric</span> <span class='kw'>then</span> <span class='id identifier rubyid_numenc'>numenc</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='kw'>true</span>    <span class='kw'>then</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>true</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='kw'>false</span>   <span class='kw'>then</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>false</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='kw'>nil</span>     <span class='kw'>then</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>null</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cannot encode </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='rbrace'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="valparse-instance_method">
  
    - (<tt>void</tt>) <strong>valparse</strong>(ts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Parses a "value" in the sense of RFC 4627. Returns the parsed value and any
trailing tokens.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rack/rack/utils/okjson.rb', line 76</span>

<span class='kw'>def</span> <span class='id identifier rubyid_valparse'>valparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>empty</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_typ'>typ</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_typ'>typ</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>{</span><span class='tstring_end'>'</span></span> <span class='kw'>then</span> <span class='id identifier rubyid_objparse'>objparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>[</span><span class='tstring_end'>'</span></span> <span class='kw'>then</span> <span class='id identifier rubyid_arrparse'>arrparse</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:val</span><span class='comma'>,</span><span class='symbol'>:str</span> <span class='kw'>then</span> <span class='lbracket'>[</span><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unexpected </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri Feb 14 16:57:20 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.3 (ruby-1.9.3).
</div>

  </body>
</html>